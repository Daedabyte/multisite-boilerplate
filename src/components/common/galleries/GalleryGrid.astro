---
/**
 * GalleryGrid
 *
 * Responsive grid layout for displaying image galleries.
 * Supports configurable columns, aspect ratios, and optional overlay captions.
 *
 * @variant grid
 * @since 1.0.0
 *
 * Best for: Portfolio showcases, product galleries, photo collections
 * Avoid when: Need slideshow functionality or sequential viewing
 *
 * @example
 * <GalleryGrid
 *   heading="Our Work"
 *   items={[
 *     { image: { src: '/img1.jpg', alt: 'Project 1' }, title: 'Project One' }
 *   ]}
 *   columns={3}
 *   aspectRatio="square"
 *   showOverlay={true}
 *   lightbox={true}
 * />
 */

import type { GalleryGridProps } from './types';
import Container from '@components/layout/Container.astro';

interface Props extends GalleryGridProps {}

const {
  heading,
  subheading,
  items,
  columns = 3,
  aspectRatio = 'square',
  gap = 'medium',
  showOverlay = true,
  lightbox = false,
  keyboard = true,
  background,
  container,
  classList,
  id = 'gallery',
  ...attrs
} = Astro.props;

const galleryId = `gallery-${id}`;
---

<section
  id={id}
  class:list={[
    'gallery',
    'gallery--grid',
    `gallery--cols-${columns}`,
    `gallery--aspect-${aspectRatio}`,
    `gallery--gap-${gap}`,
    showOverlay && 'gallery--overlay',
    lightbox && 'gallery--lightbox',
    background?.variant === 'alt' && 'gallery--alt',
    background?.variant === 'dark' && 'gallery--dark',
    classList
  ]}
  data-gallery={lightbox ? galleryId : undefined}
  data-gallery-keyboard={lightbox ? (keyboard ? 'true' : 'false') : undefined}
  {...attrs}
>
  <Container {...container}>
    {(heading || subheading) && (
      <div class="gallery__header">
        {heading && <h2 class="gallery__heading">{heading}</h2>}
        {subheading && <p class="gallery__subheading">{subheading}</p>}
      </div>
    )}

    <div class="gallery__grid">
      {items.map((item, index) => (
        <figure
          class="gallery__item"
          data-gallery-item={lightbox ? index : undefined}
        >
          {lightbox ? (
            <button
              type="button"
              class="gallery__trigger"
              data-gallery-trigger={galleryId}
              data-gallery-index={index}
              aria-label={`View ${item.title || `image ${index + 1}`}`}
            >
              <img
                src={item.image.src}
                alt={item.image.alt}
                class="gallery__image"
                loading={index < 6 ? 'eager' : 'lazy'}
              />
              {showOverlay && (item.title || item.description) && (
                <figcaption class="gallery__overlay">
                  {item.title && <span class="gallery__title">{item.title}</span>}
                  {item.description && <span class="gallery__description">{item.description}</span>}
                </figcaption>
              )}
            </button>
          ) : item.href ? (
            <a href={item.href} class="gallery__link">
              <img
                src={item.image.src}
                alt={item.image.alt}
                class="gallery__image"
                loading={index < 6 ? 'eager' : 'lazy'}
              />
              {showOverlay && (item.title || item.description) && (
                <figcaption class="gallery__overlay">
                  {item.title && <span class="gallery__title">{item.title}</span>}
                  {item.description && <span class="gallery__description">{item.description}</span>}
                </figcaption>
              )}
            </a>
          ) : (
            <>
              <img
                src={item.image.src}
                alt={item.image.alt}
                class="gallery__image"
                loading={index < 6 ? 'eager' : 'lazy'}
              />
              {showOverlay && (item.title || item.description) && (
                <figcaption class="gallery__overlay">
                  {item.title && <span class="gallery__title">{item.title}</span>}
                  {item.description && <span class="gallery__description">{item.description}</span>}
                </figcaption>
              )}
            </>
          )}
        </figure>
      ))}
    </div>

    <slot />
  </Container>
</section>

{lightbox && (
  <div
    class="gallery-lightbox"
    data-gallery-lightbox={galleryId}
    role="dialog"
    aria-modal="true"
    aria-label="Image gallery"
    hidden
  >
    <div class="gallery-lightbox__backdrop" data-gallery-close></div>
    <div class="gallery-lightbox__content">
      <button
        type="button"
        class="gallery-lightbox__close"
        data-gallery-close
        aria-label="Close gallery"
      >
        <i class="fa-solid fa-xmark" aria-hidden="true"></i>
      </button>

      <button
        type="button"
        class="gallery-lightbox__nav gallery-lightbox__nav--prev"
        data-gallery-prev
        aria-label="Previous image"
      >
        <i class="fa-solid fa-chevron-left" aria-hidden="true"></i>
      </button>

      <div class="gallery-lightbox__stage">
        <img
          class="gallery-lightbox__image"
          src=""
          alt=""
          data-gallery-image
        />
        <div class="gallery-lightbox__caption" data-gallery-caption></div>
      </div>

      <button
        type="button"
        class="gallery-lightbox__nav gallery-lightbox__nav--next"
        data-gallery-next
        aria-label="Next image"
      >
        <i class="fa-solid fa-chevron-right" aria-hidden="true"></i>
      </button>

      <div class="gallery-lightbox__counter" data-gallery-counter></div>
    </div>
  </div>
)}

<style lang="scss" is:global>
  @use './galleries.scss';
</style>
