---
/**
 * Button
 *
 * Flexible button component that renders as <a> or <button> based on props.
 * Supports multiple color variants, sizes, and outline styles.
 *
 * @since 1.0.0
 *
 * Best for: CTAs, form submissions, navigation actions
 * Avoid when: Need icon-only buttons (use ButtonIcon)
 *
 * @example
 * <Button variant="primary" href="/contact">Contact Us</Button>
 * <Button variant="secondary" outline type="submit">Submit</Button>
 */

import type { ButtonProps } from './buttons/types';

interface Props extends ButtonProps {}

const {
  variant = 'primary',
  outline = false,
  weight,
  size = 'medium',
  href,
  type = 'button',
  disabled = false,
  fullWidth = false,
  iconBefore,
  iconAfter,
  classList,
  ...attrs
} = Astro.props;

const Tag = href ? 'a' : 'button';
const tagProps = href ? { href } : { type, disabled };
---

<Tag
  class:list={[
    'btn',
    `btn--${variant}${outline ? '-outline' : ''}${weight ? `-${weight}` : ''}`,
    `btn--${size}`,
    fullWidth && 'btn--full-width',
    classList
  ]}
  {...tagProps}
  {...attrs}
>
  {iconBefore && <i class={iconBefore}></i>}
  <slot />
  {iconAfter && <i class={iconAfter}></i>}
</Tag>

<style lang="scss" is:global>
  @use "sass:color";
  @use "../../styles/abstracts" as *;

  // Button Variants
  @mixin button-variant($color, $weight: null, $outline: false) {
    $variant: if($weight != null, "#{$color}-#{$weight}", $color);
    //$dark: text-color(color($color, if($weight != null, $weight, 500)));
    $dark: text-contrast(color($color, if($weight != null, $weight, 500)));
    $text-color: if($dark, "black", "white");

    @if $outline {
      color: var(--color-#{$variant});
      background-color: transparent;
      border-color: var(--color-#{$variant});

      &:hover:not(:disabled) {
        color: var(--color-#{$text-color});
        background-color: var(--color-#{$variant});
        border-color: var(--color-#{$variant});
      }
    } @else {
      $percent: if($dark, -10%, 10%);
      $background-color: color.adjust(color($color, if($weight != null, $weight, 500)), $lightness: $percent);
      //$hover-text-color: if(text-color($background-color), "black", "white");
      $hover-text-color: if(text-contrast($background-color), "black", "white");
    
      background-color: var(--color-#{$variant});
      border-color: var(--color-#{$variant});
      color: var(--color-#{$text-color});

      &:hover:not(:disabled) {
        background-color: $background-color;
        border-color: $background-color;
        color: var(--color-#{$hover-text-color});
      }
    }
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    border: 2px solid transparent;
    border-radius: var(--border-radius-base);
    font-weight: 500;
    text-decoration: none;
    white-space: nowrap;
    cursor: pointer;
    transition: var(--transition-fast);

    @include focus-visible;

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    @each $color-name, $palette in $colors {
      &--#{$color-name} {
        @include button-variant($color-name);
      }

      &--#{$color-name}-outline {
        @include button-variant($color-name, $outline: true);
      }

      @each $weight, $color in $palette {
        &--#{$color-name}-#{$weight} {
          @include button-variant($color-name, $weight);
        }

        &--#{$color-name}-outline-#{$weight} {
          @include button-variant($color-name, $weight, $outline: true);
        }
      }
    }

    // Sizes
    &--small {
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-sm);
    }

    &--large {
      padding: var(--space-3) var(--space-6);
      font-size: var(--font-size-lg);
    }

    // Full width
    &--full-width {
      width: 100%;
    }
  }
</style>
