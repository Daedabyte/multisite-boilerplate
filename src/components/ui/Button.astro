---
export interface Props {
  variant?: "primary" | "secondary" | "tertiary" | "success" | "danger" | "warning" | "info" | "light" | "dark" | "black" | "white";
  outline?: boolean;
  weight?: 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900;
  size?: "small" | "medium" | "large";
  href?: string;
  type?: "button" | "submit" | "reset";
  disabled?: boolean;
  classList?: string;
}

const {
  variant = "primary",
  outline = false,
  weight,
  size = "medium",
  href,
  type = "button",
  disabled = false,
  classList = "",
  ...attrs
} = Astro.props;

const Tag = href ? "a" : "button";
const props = href ? { href } : { type, disabled };
---

<Tag
  class={`btn btn--${variant}${outline ? "-outline" : ""}${weight ? `-${weight}` : ""} btn--${size} ${classList}`}
  {...props}
  {...attrs}
>
  <slot />
</Tag>

<style lang="scss" is:global>
  @use "sass:color";
  @use "../../styles/abstracts" as *;

  // Button Variants
  @mixin button-variant($color, $weight: null, $outline: false) {
    $variant: if($weight != null, "#{$color}-#{$weight}", $color);
    //$dark: text-color(color($color, if($weight != null, $weight, 500)));
    $dark: text-contrast(color($color, if($weight != null, $weight, 500)));
    $text-color: if($dark, "black", "white");

    @if $outline {
      color: var(--color-#{$variant});
      background-color: transparent;
      border-color: var(--color-#{$variant});

      &:hover:not(:disabled) {
        color: var(--color-#{$text-color});
        background-color: var(--color-#{$variant});
        border-color: var(--color-#{$variant});
      }
    } @else {
      $percent: if($dark, -10%, 10%);
      $background-color: color.adjust(color($color, if($weight != null, $weight, 500)), $lightness: $percent);
      //$hover-text-color: if(text-color($background-color), "black", "white");
      $hover-text-color: if(text-contrast($background-color), "black", "white");
    
      background-color: var(--color-#{$variant});
      border-color: var(--color-#{$variant});
      color: var(--color-#{$text-color});

      &:hover:not(:disabled) {
        background-color: $background-color;
        border-color: $background-color;
        color: var(--color-#{$hover-text-color});
      }
    }
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    border: 2px solid transparent;
    border-radius: var(--border-radius-base);
    font-weight: 500;
    text-decoration: none;
    white-space: nowrap;
    cursor: pointer;
    transition: var(--transition-fast);

    @include focus-visible;

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    @each $color-name, $palette in $colors {
      &--#{$color-name} {
        @include button-variant($color-name);
      }

      &--#{$color-name}-outline {
        @include button-variant($color-name, $outline: true);
      }

      @each $weight, $color in $palette {
        &--#{$color-name}-#{$weight} {
          @include button-variant($color-name, $weight);
        }

        &--#{$color-name}-outline-#{$weight} {
          @include button-variant($color-name, $weight, $outline: true);
        }
      }
    }

    // Sizes
    &--small {
      padding: var(--space-1) var(--space-3);
      font-size: var(--font-size-sm);
    }

    &--large {
      padding: var(--space-3) var(--space-6);
      font-size: var(--font-size-lg);
    }
  }
</style>
