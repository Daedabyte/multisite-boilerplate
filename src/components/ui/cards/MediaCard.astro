---
/**
 * MediaCard
 *
 * Card with image and content in configurable layouts.
 * Image can be positioned top, left, or right.
 *
 * @since 1.0.0
 *
 * Best for: Blog posts, articles, product cards, team members
 */

import type { CardBaseProps } from './types';

// ===================================
// MediaCard Types
// ===================================

/** Image layout position options */
export type MediaCardLayout = 'top' | 'left' | 'right';

/** Aspect ratio options */
export type MediaCardAspectRatio = 'square' | 'video' | 'portrait' | 'auto';

/** Props for MediaCard component */
interface Props extends CardBaseProps {
  /** Card title */
  title: string;
  /** Card description */
  description?: string;
  /** Image URL */
  image: string;
  /** Image alt text */
  imageAlt?: string;
  /** Image position relative to content */
  layout?: MediaCardLayout;
  /** Image aspect ratio */
  aspectRatio?: MediaCardAspectRatio;
  /** Meta text (category, date, etc.) */
  meta?: string;
  /** Call-to-action link text */
  ctaText?: string;
}

const {
  title,
  description,
  image,
  imageAlt = '',
  layout = 'top',
  aspectRatio = 'video',
  meta,
  ctaText,
  hover = 'lift',
  radius = 'medium',
  href,
  external,
  shadow = false,
  bordered = true,
  classList,
  id,
  ...attrs
} = Astro.props;

const Tag = href ? 'a' : 'div';
const linkProps = href ? {
  href,
  target: external ? '_blank' : undefined,
  rel: external ? 'noopener noreferrer' : undefined,
} : {};
---

<Tag
  id={id}
  class:list={[
    'media-card',
    `media-card--layout-${layout}`,
    `media-card--aspect-${aspectRatio}`,
    `media-card--radius-${radius}`,
    `media-card--hover-${hover}`,
    shadow && 'media-card--shadow',
    bordered && 'media-card--bordered',
    href && 'media-card--clickable',
    classList
  ]}
  {...linkProps}
  {...attrs}
>
  <div class="media-card__image-wrapper">
    <img src={image} alt={imageAlt} class="media-card__image" loading="lazy" />
  </div>
  <div class="media-card__body">
    {meta && <span class="media-card__meta">{meta}</span>}
    <h3 class="media-card__title">{title}</h3>
    {description && <p class="media-card__description">{description}</p>}
    <slot />
    {ctaText && (
      <span class="media-card__cta">
        {ctaText}
        <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>
      </span>
    )}
  </div>
</Tag>

<style lang="scss">
  @use './_card-base.scss' as *;

  .media-card {
    @include card-base;
    display: flex;
    overflow: hidden;

    @include card-variants;
    @include card-hover-variants;

    // Layout variants
    &--layout-top {
      flex-direction: column;
    }

    &--layout-left {
      flex-direction: row;

      .media-card__image-wrapper {
        width: 40%;
        flex-shrink: 0;
      }
    }

    &--layout-right {
      flex-direction: row-reverse;

      .media-card__image-wrapper {
        width: 40%;
        flex-shrink: 0;
      }
    }

    // Image wrapper
    &__image-wrapper {
      overflow: hidden;
    }

    &--layout-top .media-card__image-wrapper {
      // Aspect ratio variants for top layout
    }

    &--aspect-square .media-card__image-wrapper { aspect-ratio: 1; }
    &--aspect-video .media-card__image-wrapper { aspect-ratio: 16 / 9; }
    &--aspect-portrait .media-card__image-wrapper { aspect-ratio: 3 / 4; }
    &--aspect-auto .media-card__image-wrapper { aspect-ratio: auto; }

    // For horizontal layouts, image fills height
    &--layout-left,
    &--layout-right {
      .media-card__image-wrapper {
        aspect-ratio: auto;
      }
    }

    &__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    // Body
    &__body {
      display: flex;
      flex-direction: column;
      padding: var(--space-5);
      flex: 1;
    }

    &__meta {
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-medium);
      color: var(--color-primary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-2);
    }

    &__title {
      margin: 0;
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      color: var(--color-neutral-900);
      line-height: 1.3;
      transition: color 0.2s ease;
    }

    &__description {
      margin: var(--space-2) 0 0;
      font-size: var(--font-size-sm);
      color: var(--color-neutral-600);
      line-height: 1.6;
      flex: 1;

      // Clamp to 3 lines
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    &__cta {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      margin-top: var(--space-4);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
      color: var(--color-primary);
      transition: gap 0.2s ease;

      i {
        font-size: var(--font-size-xs);
        transition: transform 0.2s ease;
      }
    }

    // Hover states
    &--clickable:hover {
      .media-card__title {
        color: var(--color-primary);
      }

      .media-card__cta {
        gap: var(--space-3);

        i {
          transform: translateX(2px);
        }
      }
    }

    // Scale hover affects image
    &--hover-scale:hover .media-card__image {
      transform: scale(1.05);
    }

    // Responsive horizontal layouts
    @media (max-width: 640px) {
      &--layout-left,
      &--layout-right {
        flex-direction: column;

        .media-card__image-wrapper {
          width: 100%;
          aspect-ratio: 16 / 9;
        }
      }
    }
  }
</style>
