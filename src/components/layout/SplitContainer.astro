---
/**
 * SplitContainer
 *
 * Flexible split layout component for side-by-side content.
 * Supports image/content splits with configurable ratios and positioning.
 *
 * @since 1.0.0
 *
 * Best for: Feature showcases, about sections, product displays, testimonials
 * Avoid when: Need more than 2 columns (use Grid instead)
 *
 * @example
 * <SplitContainer
 *   image={{ src: '/image.jpg', alt: 'Description' }}
 *   imagePosition="left"
 *   ratio="50-50"
 *   verticalAlign="center"
 * >
 *   <h2>Content Title</h2>
 *   <p>Content description goes here...</p>
 * </SplitContainer>
 *
 * @example With slots for both sides
 * <SplitContainer ratio="40-60">
 *   <div slot="start">Left content</div>
 *   <div slot="end">Right content</div>
 * </SplitContainer>
 */

import type { BaseProps, ImageProps } from '@types';

// ===================================
// SplitContainer Types
// ===================================

/** Split layout ratio options */
export type SplitRatio = '50-50' | '40-60' | '60-40' | '33-67' | '67-33';

/** Position of media/image in split layout */
export type SplitImagePosition = 'left' | 'right';

/** Vertical alignment options for split columns */
export type SplitVerticalAlign = 'start' | 'center' | 'end' | 'stretch';

/** Props for SplitContainer component */
interface Props extends BaseProps {
  /** Image configuration (optional if using slots) */
  image?: ImageProps;
  /** Position of the image relative to content */
  imagePosition?: SplitImagePosition;
  /** Column ratio (first value is left column) */
  ratio?: SplitRatio;
  /** Vertical alignment of columns */
  verticalAlign?: SplitVerticalAlign;
  /** Gap between columns */
  gap?: 'none' | 'small' | 'medium' | 'large';
  /** Reverse stack order on mobile */
  mobileReverse?: boolean;
  /** Add border radius to image */
  imageRounded?: boolean;
  /** Add shadow to image */
  imageShadow?: boolean;
}

const {
  image,
  imagePosition = 'right',
  ratio = '50-50',
  verticalAlign = 'center',
  gap = 'large',
  mobileReverse = false,
  imageRounded = true,
  imageShadow = false,
  classList,
  id,
  ...attrs
} = Astro.props;

// Check if we have named slots
const hasStartSlot = Astro.slots.has('start');
const hasEndSlot = Astro.slots.has('end');
const useSlots = hasStartSlot || hasEndSlot;
---

<div
  id={id}
  class:list={[
    'split',
    `split--ratio-${ratio}`,
    `split--align-${verticalAlign}`,
    `split--gap-${gap}`,
    imagePosition === 'left' && 'split--image-left',
    mobileReverse && 'split--mobile-reverse',
    classList
  ]}
  {...attrs}
>
  {useSlots ? (
    <>
      <div class="split__column split__column--start">
        <slot name="start" />
      </div>
      <div class="split__column split__column--end">
        <slot name="end" />
      </div>
    </>
  ) : (
    <>
      <div class="split__content">
        <slot />
      </div>
      {image && (
        <div
          class:list={[
            'split__media',
            imageRounded && 'split__media--rounded',
            imageShadow && 'split__media--shadow'
          ]}
        >
          <img
            src={typeof image.src === 'string' ? image.src : image.src}
            alt={image.alt}
            loading={image.loading ?? 'lazy'}
            width={image.width}
            height={image.height}
          />
        </div>
      )}
    </>
  )}
</div>

<style lang="scss" is:global>
  @use "../../styles/abstracts" as *;

  .split {
    display: grid;
    gap: var(--space-8);

    @include media-up('lg') {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-12);
    }

    // Column children
    &__content,
    &__media,
    &__column {
      min-width: 0; // Prevent overflow
    }

    &__content {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    &__media {
      img {
        width: 100%;
        height: auto;
        display: block;
      }

      &--rounded img {
        border-radius: var(--border-radius-xl);
      }

      &--shadow img {
        box-shadow: var(--shadow-lg);
      }
    }

    // Ratios
    &--ratio-50-50 {
      @include media-up('lg') {
        grid-template-columns: 1fr 1fr;
      }
    }

    &--ratio-40-60 {
      @include media-up('lg') {
        grid-template-columns: 2fr 3fr;
      }
    }

    &--ratio-60-40 {
      @include media-up('lg') {
        grid-template-columns: 3fr 2fr;
      }
    }

    &--ratio-33-67 {
      @include media-up('lg') {
        grid-template-columns: 1fr 2fr;
      }
    }

    &--ratio-67-33 {
      @include media-up('lg') {
        grid-template-columns: 2fr 1fr;
      }
    }

    // Image position (only affects image/content mode, not slots)
    &--image-left {
      .split__media {
        @include media-up('lg') {
          order: -1;
        }
      }
    }

    // Vertical alignment
    &--align-start {
      align-items: start;
    }

    &--align-center {
      align-items: center;
    }

    &--align-end {
      align-items: end;
    }

    &--align-stretch {
      align-items: stretch;
    }

    // Gap variants
    &--gap-none {
      gap: 0;

      @include media-up('lg') {
        gap: 0;
      }
    }

    &--gap-small {
      gap: var(--space-4);

      @include media-up('lg') {
        gap: var(--space-6);
      }
    }

    &--gap-medium {
      gap: var(--space-6);

      @include media-up('lg') {
        gap: var(--space-8);
      }
    }

    &--gap-large {
      gap: var(--space-8);

      @include media-up('lg') {
        gap: var(--space-12);
      }
    }

    // Mobile reverse (image first on mobile)
    &--mobile-reverse {
      .split__content {
        order: 1;

        @include media-up('lg') {
          order: initial;
        }
      }

      .split__media {
        order: 0;

        @include media-up('lg') {
          order: initial;
        }
      }
    }
  }
</style>
